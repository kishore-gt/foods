<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title th:text="${itemId} != null ? 'Edit Item' : 'New Item'">Menu Item</title>
	<link rel="stylesheet" th:href="@{/css/bootstrap.css}">
	<link rel="stylesheet" th:href="@{/css/font-awesome.min.css}">
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}
		
		body {
			font-family: 'Poppins', sans-serif;
			background-color: #fffaf3;
			color: #333;
		}
		
		.navbar-custom {
			background: linear-gradient(135deg, #fc8019 0%, #e66a00 100%);
			padding: 15px 0;
			box-shadow: 0 4px 20px rgba(220, 53, 69, 0.3);
		}
		.navbar-custom .navbar-brand {
			color: #fff;
			font-weight: 700;
			font-size: 24px;
			letter-spacing: 1px;
		}
		.navbar-custom .nav-link {
			color: #fff;
			font-weight: 500;
			padding: 8px 16px;
			border-radius: 25px;
			transition: all 0.3s ease;
		}
		.navbar-custom .nav-link:hover {
			background: rgba(255, 255, 255, 0.2);
			transform: translateY(-2px);
		}
		
		.form-container {
			background: #fff;
			border-radius: 20px;
			padding: 40px;
			box-shadow: 0 8px 25px rgba(0,0,0,0.1);
			margin-bottom: 30px;
		}
		.form-container h3 {
			color: #fc8019;
			font-weight: 700;
			margin-bottom: 30px;
		}
		
		.form-control {
			border-radius: 10px;
			border: 2px solid #e0e0e0;
			padding: 12px 15px;
			transition: all 0.3s ease;
		}
		.form-control:focus {
			border-color: #fc8019;
			box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
		}
		
		.btn-primary {
			background: linear-gradient(135deg, #fc8019 0%, #e66a00 100%);
			border: none;
			border-radius: 50px;
			padding: 12px 25px;
			font-weight: 600;
			transition: all 0.3s ease;
			box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
		}
		.btn-primary:hover {
			transform: translateY(-2px);
			box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
		}
		.btn-secondary {
			background: #6c757d;
			border: none;
			border-radius: 50px;
			padding: 12px 25px;
			font-weight: 600;
			color: #fff;
		}
		.btn-secondary:hover {
			background: #5a6268;
			color: #fff;
		}
		.btn-outline-primary {
			border-color: #fc8019;
			color: #fc8019;
		}
		.btn-outline-primary:hover {
			background: linear-gradient(135deg, #fc8019 0%, #e66a00 100%);
			border-color: #fc8019;
			color: #fff;
		}
	</style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-custom">
	<div class="container">
		<a class="navbar-brand" th:href="@{/chef/dashboard}">Tummy Go!</a>
		<div class="ml-auto d-flex align-items-center">
			<a class="nav-link" th:href="@{/chef/dashboard}">Dashboard</a>
			<a class="nav-link" th:href="@{/chef/menus}">Menus</a>
			<a class="nav-link" th:href="@{/chef/orders}">Orders</a>
			<a class="nav-link" th:href="@{/logout}">Logout</a>
		</div>
	</div>
</nav>

<div class="container py-4" th:with="isEdit=${itemId} != null">
	<div class="form-container">
		<h3 th:text="${isEdit} ? 'Edit Item' : 'Create Item'">Item</h3>
		<form th:action="${isEdit} ? @{'/chef/items/' + ${itemId} + '/edit'} : @{'/chef/menus/' + ${menu.id} + '/items'}" th:object="${menuItemForm}" method="post">
			<input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
			<div class="mb-3">
				<label class="form-label" style="font-weight: 600;">Name</label>
				<input type="text" class="form-control" th:field="*{name}">
				<div class="text-danger" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
			</div>
			<div class="mb-3">
				<label class="form-label" style="font-weight: 600;">Description</label>
				<textarea class="form-control" rows="3" th:field="*{description}"></textarea>
				<div class="text-danger" th:if="${#fields.hasErrors('description')}" th:errors="*{description}"></div>
			</div>
			<div class="mb-3">
				<label class="form-label" style="font-weight: 600;">Price</label>
				<input type="number" step="0.01" min="0" class="form-control" th:field="*{price}">
				<div class="text-danger" th:if="${#fields.hasErrors('price')}" th:errors="*{price}"></div>
			</div>
			<div class="mb-3">
				<label class="form-label" style="font-weight: 600;">Image URL</label>
				<input type="url" class="form-control" id="imageUrlInput" th:field="*{imageUrl}" placeholder="https://example.com/image.jpg" oninput="updateImagePreview()">
				<small class="form-text text-muted">
					Enter a direct image URL (e.g., https://example.com/image.jpg). 
					<strong>Note:</strong> Google Images share links won't work. Use direct image URLs ending in .jpg, .png, .gif, etc.
				</small>
				<div id="urlWarning" class="alert alert-warning mt-2" style="display: none; padding: 8px 12px; font-size: 0.875rem;">
					<i class="fa fa-exclamation-triangle"></i> This appears to be a Google Images share link. Please use a direct image URL instead.
				</div>
				<div class="text-danger" th:if="${#fields.hasErrors('imageUrl')}" th:errors="*{imageUrl}"></div>
				<div id="imagePreview" class="mt-3" style="display: none;">
					<label class="form-label" style="font-weight: 600;">Preview:</label>
					<div style="max-width: 300px; border-radius: 10px; overflow: hidden; border: 2px solid #fc8019;">
						<img id="previewImg" src="" alt="Menu Item Image Preview" style="width: 100%; height: auto; display: block;" onerror="handleImageError();">
					</div>
				</div>
			</div>
			<div class="mb-4" th:if="${availableTags != null}">
                <label class="form-label d-block" style="font-weight: 600;">Tags / Filters</label>
                <div class="small text-muted mb-2">Select the filters that describe this dish (e.g., Breakfast, Veg, Juices).</div>
                <div class="d-flex flex-wrap">
                    <div class="form-check form-check-inline mb-2" th:each="entry : ${availableTags.entrySet()}">
                        <input class="btn-check" type="checkbox"
                               th:id="${'tag-' + entry.key}"
                               th:value="${entry.key}"
                               th:field="*{tags}">
                        <label class="btn btn-outline-primary btn-sm" th:for="${'tag-' + entry.key}" th:text="${entry.value}">Breakfast</label>
                    </div>
                </div>
            </div>
			<div class="mb-3">
				<label class="form-label" style="font-weight: 600;">Category</label>
				<select class="form-control" th:field="*{category}">
					<option value="">Select Category</option>
					<option value="STARTERS">Starters</option>
					<option value="DESSERTS">Desserts</option>
					<option value="BEVERAGES">Beverages</option>
					<option value="SNACKS">Snacks</option>
					<option value="RICE">Rice</option>
					<option value="BREADS">Breads</option>
					<option value="CURRIES">Curries</option>
					<option value="SOUPS">Soups</option>
					<option value="SALADS">Salads</option>
				</select>
				<div class="text-danger" th:if="${#fields.hasErrors('category')}" th:errors="*{category}"></div>
			</div>
			<div class="mb-3">
				<label class="form-label" style="font-weight: 600;">Veg / Non-Veg</label>
				<div class="d-flex gap-3">
					<div class="form-check">
						<input class="form-check-input" type="radio" th:field="*{isVeg}" id="veg" th:value="true">
						<label class="form-check-label" for="veg" style="font-weight: 500;">
							<span style="color: #28a745;">ðŸŸ¢ Veg</span>
						</label>
					</div>
					<div class="form-check">
						<input class="form-check-input" type="radio" th:field="*{isVeg}" id="nonveg" th:value="false">
						<label class="form-check-label" for="nonveg" style="font-weight: 500;">
							<span style="color: #fc8019;">ðŸ”´ Non-Veg</span>
						</label>
					</div>
				</div>
			</div>
			<div class="form-check mb-4">
				<input class="form-check-input" type="checkbox" th:field="*{available}" id="available">
				<label class="form-check-label" for="available" style="font-weight: 500;">Available</label>
			</div>
			<div class="d-flex gap-2">
				<button class="btn btn-primary" type="submit" th:text="${isEdit} ? 'Update Item' : 'Create Item'">Save</button>
				<a class="btn btn-secondary" th:href="@{|/chef/menus/${menu.id}/items|}">Cancel</a>
			</div>
		</form>
	</div>
</div>

<script th:src="@{/js/jquery-3.4.1.min.js}"></script>
<script th:src="@{/js/bootstrap.js}"></script>
<script>
	function updateImagePreview() {
		const input = document.getElementById('imageUrlInput');
		const preview = document.getElementById('imagePreview');
		const img = document.getElementById('previewImg');
		const warning = document.getElementById('urlWarning');
		
		if (input.value && input.value.trim() !== '') {
			const url = input.value.trim();
			
			// Check if it's a Google Images share link
			if (url.includes('share.google/images/') || url.includes('google.com/images/')) {
				warning.style.display = 'block';
				preview.style.display = 'none';
				return;
			} else {
				warning.style.display = 'none';
			}
			
			img.src = url;
			img.onload = function() {
				preview.style.display = 'block';
			};
			img.onerror = function() {
				handleImageError();
			};
		} else {
			warning.style.display = 'none';
			preview.style.display = 'none';
		}
	}
	
	function handleImageError() {
		const preview = document.getElementById('imagePreview');
		preview.style.display = 'none';
	}
	
	// Initialize preview on page load if there's an existing image URL
	document.addEventListener('DOMContentLoaded', function() {
		const input = document.getElementById('imageUrlInput');
		if (input && input.value) {
			updateImagePreview();
		}
	});
</script>
</body>
</html>
