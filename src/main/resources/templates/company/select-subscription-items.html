<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Select Subscription Items - Tummy Go!</title>
	<link rel="stylesheet" th:href="@{/css/bootstrap.css}">
	<link rel="stylesheet" th:href="@{/css/font-awesome.min.css}">
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
		rel="stylesheet">
	<style>
		body {
			font-family: 'Poppins', sans-serif;
			background-color: #fffaf3;
		}

		.navbar-custom {
			background: linear-gradient(135deg, #fc8019 0%, #e66a00 100%);
			padding: 15px 0;
		}

		.navbar-custom .navbar-brand,
		.navbar-custom .nav-link {
			color: #fff;
			font-weight: 500;
		}

		.package-info {
			background: linear-gradient(135deg, #fc8019 0%, #e66a00 100%);
			color: #fff;
			border-radius: 15px;
			padding: 25px;
			margin-bottom: 30px;
		}

		.menu-item-card {
			background: #fff;
			border: 2px solid #e0e0e0;
			border-radius: 15px;
			padding: 20px;
			margin-bottom: 15px;
			cursor: pointer;
			transition: all 0.3s ease;
		}

		.menu-item-card:hover {
			border-color: #fc8019;
			transform: translateY(-3px);
			box-shadow: 0 4px 15px rgba(220, 53, 69, 0.2);
		}

		.menu-item-card.selected {
			border-color: #fc8019;
			background: #fff5eb;
		}

		.btn-primary {
			background: linear-gradient(135deg, #fc8019 0%, #e66a00 100%);
			border: none;
			border-radius: 50px;
			padding: 12px 25px;
			font-weight: 600;
		}

		.payment-section {
			background: #fff;
			border-radius: 15px;
			padding: 30px;
			box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
			margin-top: 30px;
		}
	</style>
</head>

<body>
	<nav class="navbar navbar-expand-lg navbar-custom">
		<div class="container">
			<a class="navbar-brand" th:href="@{/company/dashboard}">Tummy Go! - Company</a>
			<div class="ml-auto">
				<a class="nav-link" th:href="@{/company/dashboard}">Dashboard</a>
				<a class="nav-link" th:href="@{/company/subscriptions}">Subscriptions</a>
				<a class="nav-link" th:href="@{/logout}">Logout</a>
			</div>
		</div>
	</nav>

	<div class="container py-4">
		<div class="package-info">
			<h3 th:text="${package.name}">Package Name</h3>
			<p class="mb-1" th:text="${package.description}">Description</p>
			<p class="mb-1" th:if="${restaurant != null}">
				<i class="fa fa-store mr-2"></i><strong th:text="${restaurant.name}">Restaurant Name</strong>
			</p>
			<p class="mb-0">
				<strong>For <span th:text="${package.numberOfPeople}">10</span> people</strong> |
				<strong>Price: ₹<span th:text="${#numbers.formatDecimal(package.price, 0, 2)}"
						id="packagePrice">0.00</span>/day</strong>
			</p>
		</div>

		<h4 class="mb-3">Included Menu Items</h4>
		<p class="text-muted mb-4" th:if="${restaurant != null}">
			The following items from <strong th:text="${restaurant.name}">Restaurant</strong> are fixed for this
			package. You cannot change them.
		</p>
		<p class="text-muted mb-4" th:if="${restaurant == null}">
			The items below are fixed for this package. You cannot change them.
		</p>

		<form th:action="@{/company/subscriptions/subscribe}" method="post" id="subscriptionForm">
			<input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
			<input type="hidden" name="packageId" th:value="${package.id}">

			<div th:if="${menuItems == null || menuItems.isEmpty()}" class="alert alert-warning">
				<i class="fa fa-exclamation-triangle mr-2"></i>
				No items are configured for this package yet. Please contact the restaurant owner.
			</div>

			<div class="row mb-4" th:if="${menuItems != null && !menuItems.isEmpty()}">
				<div class="col-md-6" th:each="item : ${menuItems}">
					<div class="menu-item-card">
						<div>
							<h6 class="mb-1" th:text="${item.name}">Item Name</h6>
							<p class="text-muted mb-1" th:text="${item.description ?: 'No description'}">Description</p>
							<p class="mb-0"><strong>₹<span
										th:text="${#numbers.formatDecimal(item.price, 0, 2)}">0.00</span></strong></p>
						</div>
					</div>
				</div>
			</div>

			<div class="payment-section">
				<h5 class="mb-4">Payment Information</h5>

				<div class="form-group mb-3">
					<label>Payment Method *</label>
					<select class="form-control" name="paymentMethod" required>
						<option value="">Select Payment Method</option>
						<option value="UPI">UPI</option>
						<option value="CARD">Credit/Debit Card</option>
						<option value="NET_BANKING">Net Banking</option>
						<option value="WALLET">Wallet</option>
						<option value="CASH_ON_DELIVERY">Cash on Delivery</option>
					</select>
				</div>

				<div class="form-group mb-3">
					<label>Transaction ID (Optional)</label>
					<input type="text" class="form-control" name="transactionId"
						placeholder="Enter transaction ID if paid online">
				</div>

				<div class="form-group mb-3">
					<label>Duration (Days) *</label>
					<select class="form-control" name="days" id="daysSelect" required onchange="calculateTotal()">
						<option value="30">30 Days (1 Month)</option>
						<option value="15">15 Days</option>
						<option value="7">7 Days (1 Week)</option>
						<option value="1">1 Day (Trial)</option>
					</select>
				</div>

				<div class="alert alert-info">
					<strong>Total Amount:</strong> ₹<span id="totalAmount">0.00</span>
				</div>

				<button type="submit" class="btn btn-primary btn-lg btn-block">
					<i class="fa fa-credit-card mr-2"></i>Subscribe &amp; Pay
				</button>
				<a class="btn btn-secondary btn-block mt-2" th:href="@{/company/subscriptions}">Cancel</a>
			</div>
		</form>
	</div>

	<script th:inline="javascript">
		// No item selection needed; items are fixed per package.

		function calculateTotal() {
			const pricePerPersonPerDay = parseFloat(/*[[${package.price}]]*/ 0);
			const numberOfPeople = parseInt(/*[[${package.numberOfPeople}]]*/ 1);
			const days = parseInt(document.getElementById('daysSelect').value);

			// Total = Price/Person/Day * People * Days
			const total = pricePerPersonPerDay * numberOfPeople * days;

			document.getElementById('totalAmount').textContent = total.toFixed(2);
		}

		// Initialize total
		document.addEventListener('DOMContentLoaded', function () {
			calculateTotal();
		});
	</script>

	<script th:src="@{/js/jquery-3.4.1.min.js}"></script>
	<script th:src="@{/js/bootstrap.js}"></script>
</body>

</html>