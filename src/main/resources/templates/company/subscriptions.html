<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Subscriptions - Tummy Go!</title>
	<link rel="stylesheet" th:href="@{/css/bootstrap.css}">
	<link rel="stylesheet" th:href="@{/css/font-awesome.min.css}">
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
		rel="stylesheet">
	<style>
		body {
			font-family: 'Poppins', sans-serif;
			background-color: #fffaf3;
		}

		.navbar-custom {
			background: linear-gradient(135deg, #fc8019 0%, #e66a00 100%);
			padding: 15px 0;
		}

		.navbar-custom .navbar-brand,
		.navbar-custom .nav-link {
			color: #fff;
			font-weight: 500;
		}

		.package-card {
			background: #fff;
			border-radius: 15px;
			padding: 30px;
			box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
			margin-bottom: 20px;
			transition: all 0.3s ease;
		}

		.package-card:hover {
			transform: translateY(-5px);
			box-shadow: 0 8px 25px rgba(220, 53, 69, 0.2);
		}

		.package-card.featured {
			border: 3px solid #fc8019;
		}

		.price {
			font-size: 2rem;
			font-weight: 700;
			color: #fc8019;
		}

		.btn-primary {
			background: linear-gradient(135deg, #fc8019 0%, #e66a00 100%);
			border: none;
			border-radius: 50px;
			padding: 12px 25px;
			font-weight: 600;
		}

		.active-subscription {
			background: linear-gradient(135deg, #fc8019 0%, #e66a00 100%);
			color: #fff;
			border-radius: 15px;
			padding: 25px;
			margin-bottom: 30px;
		}
	</style>
</head>

<body>
	<nav class="navbar navbar-expand-lg navbar-custom">
		<div class="container">
			<a class="navbar-brand" th:href="@{/company/dashboard}">Tummy Go! - Company</a>
			<div class="ml-auto">
				<a class="nav-link" th:href="@{/company/dashboard}">Dashboard</a>
				<a class="nav-link" th:href="@{/company/orders}">Orders</a>
				<a class="nav-link" th:href="@{/logout}">Logout</a>
			</div>
		</div>
	</nav>

	<div class="container py-4">
		<h2 class="mb-4">Subscription Packages</h2>
		<p class="text-muted mb-4">Browse subscription packages by restaurant. Each restaurant offers their own packages
			with their menu items.</p>

		<div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
			<span th:text="${success}"></span>
			<button type="button" class="close" data-dismiss="alert">&times;</button>
		</div>
		<div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
			<span th:text="${error}"></span>
			<button type="button" class="close" data-dismiss="alert">&times;</button>
		</div>

		<div th:if="${activeSubscription != null}" class="active-subscription">
			<h4><i class="fa fa-check-circle mr-2"></i>Active Subscription</h4>
			<p class="mb-1"><strong th:text="${activeSubscription.subscriptionPackage.name}">Package Name</strong></p>
			<p class="mb-1">For <span th:text="${activeSubscription.peopleCount}">1</span>
				people</p>
			<p class="mb-1">Payment: <span th:text="${activeSubscription.paymentStatus}">PAID</span> |
				Amount: ₹<span th:text="${#numbers.formatDecimal(activeSubscription.paymentAmount, 0, 2)}">0.00</span>
			</p>
			<p class="mb-0">Valid until: <span
					th:text="${#temporals.format(activeSubscription.endDate, 'dd MMM yyyy')}">Date</span></p>
			<div th:if="${activeSubscription.items != null && !activeSubscription.items.isEmpty()}" class="mt-3">
				<strong>Selected Items:</strong>
				<ul class="mb-0" style="list-style: none; padding-left: 0;">
					<li th:each="item : ${activeSubscription.items}">
						<i class="fa fa-check mr-2"></i><span th:text="${item.menuItem.name}">Item Name</span>
					</li>
				</ul>
			</div>
			<div class="mt-2" style="display: none;">
				<!-- Edit items removed as items are fixed for the package -->
				<a class="btn btn-light btn-sm"
					th:href="@{|/company/subscriptions/${activeSubscription.id}/edit-items|}">
					<i class="fa fa-edit mr-1"></i>Edit items
				</a>
			</div>
		</div>

		<div th:if="${restaurants == null || restaurants.isEmpty()}" class="alert alert-info">
			<p>No restaurants with subscription packages available yet.</p>
		</div>

		<div th:if="${companyRequests != null && !companyRequests.isEmpty()}" class="mb-4">
			<h4>Your Requests</h4>
			<div class="table-responsive">
				<table class="table table-striped">
					<thead>
						<tr>
							<th>Package</th>
							<th>Restaurant</th>
							<th>People</th>
							<th>Duration</th>
							<th>Time</th>
							<th>Skip Days</th>
							<th>Status</th>
							<th>Total</th>
							<th>Action</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="req : ${companyRequests}">
							<td th:text="${req.subscriptionPackage.name}">Package</td>
							<td th:text="${req.subscriptionPackage.restaurant.name}">Restaurant</td>
							<td th:text="${req.peopleCount}">1</td>
							<td>
								<span th:text="${req.durationMonths != null ? req.durationMonths : 1}"></span> month(s)
							</td>
							<td th:text="${req.preferredTime ?: '-'}">-</td>
							<td th:text="${req.excludedDays ?: '-'}">-</td>
							<td>
								<span class="badge badge-warning" th:if="${req.status == 'REQUESTED'}">Requested</span>
								<span class="badge badge-success" th:if="${req.status == 'APPROVED'}">Approved -
									Pay</span>
								<span class="badge badge-danger" th:if="${req.status == 'REJECTED'}">Rejected</span>
								<span class="badge badge-primary" th:if="${req.status == 'ACTIVE'}">Active</span>
							</td>
							<td>₹<span th:text="${#numbers.formatDecimal(req.totalAmount,0,2)}">0.00</span></td>
							<td>
								<a th:if="${req.status == 'APPROVED'}"
									th:href="@{|/company/subscriptions/${req.id}/payment|}"
									class="btn btn-primary btn-sm">
									<i class="fa fa-credit-card mr-1"></i>Proceed to Payment
								</a>
								<span th:if="${req.status == 'REQUESTED'}" class="text-muted">Awaiting owner
									approval</span>
								<span th:if="${req.status == 'REJECTED'}" class="text-danger">Owner rejected</span>
								<span th:if="${req.status == 'ACTIVE'}" class="text-success">Active</span>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>

		<div class="row" th:if="${restaurants != null && !restaurants.isEmpty()}">
			<div class="col-md-6 mb-4" th:each="restaurant : ${restaurants}">
				<div class="package-card">
					<h4 th:text="${restaurant.name}">Restaurant Name</h4>
					<p class="text-muted" th:text="${restaurant.address}">Restaurant Address</p>
					<p class="text-muted" th:if="${restaurant.cuisineType != null}">
						<i class="fa fa-utensils mr-2"></i><span th:text="${restaurant.cuisineType}">Cuisine</span>
					</p>
					<a class="btn btn-primary btn-block"
						th:href="@{|/company/subscriptions/restaurant/${restaurant.id}|}">
						<i class="fa fa-eye mr-2"></i>View Packages
					</a>
				</div>
			</div>
		</div>
	</div>

	<script th:src="@{/js/jquery-3.4.1.min.js}"></script>
	<script th:src="@{/js/bootstrap.js}"></script>
</body>

</html>